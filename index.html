<!DOCTYPE html>
<html lang="fr">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Club de Jeux de SociÃ©tÃ© - Catalogue</title>
Â  Â  <style>
Â  Â  Â  Â  /* ======================================================= */
Â  Â  Â  Â  /* RÃˆGLES DE BASE ET STYLE GÃ‰NÃ‰RAL */
Â  Â  Â  Â  /* ======================================================= */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  Â  Â  Â  /* Marge adaptÃ©e au panier compact */
Â  Â  Â  Â  Â  Â  margin: 80px 20px 200px 20px;Â 
Â  Â  Â  Â  Â  Â  background-color: #f4f4f4;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  }
Â  Â  Â  Â  h1, h2 { color: #333; }
Â  Â  Â  Â  .produit {
Â  Â  Â  Â  Â  Â  background-color: white;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  .prix { font-weight: bold; color: green; }
Â  Â  Â  Â  .rupture { color: red; font-weight: bold; }

Â  Â  Â  Â  /* Style pour les catÃ©gories */
Â  Â  Â  Â  .categorie-section {
Â  Â  Â  Â  Â  Â  margin-top: 30px;
Â  Â  Â  Â  Â  Â  border-bottom: 2px solid #ccc;
Â  Â  Â  Â  Â  Â  padding-bottom: 5px;
Â  Â  Â  Â  }
        
        /* ======================================================= */
Â  Â  Â  Â  /* STYLE DU LOGO */
Â  Â  Â  Â  /* ======================================================= */
Â  Â  Â  Â  #logo-asso {
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  top: 20px;Â 
Â  Â  Â  Â  Â  Â  right: 20px;Â 
Â  Â  Â  Â  Â  Â  z-index: 50;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ======================================================= */
Â  Â  Â  Â  /* PANIER FIXÃ‰ EN BAS DE L'Ã‰CRAN (RÃ¨gles ForcÃ©es) */
Â  Â  Â  Â  /* ======================================================= */
Â  Â  Â  Â  #panier-fixe {
Â  Â  Â  Â  Â  Â  position: fixed !important;Â /* FORCÃ‰ */
Â  Â  Â  Â  Â  Â  bottom: 0 !important; /* FORCÃ‰ EN BAS */
Â  Â  Â  Â  Â  Â  left: 0;
            right: 0;
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  max-height: 35vh;
Â  Â  Â  Â  Â  Â  background-color: #fff;
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 -4px 10px rgba(0,0,0,0.15);Â 
Â  Â  Â  Â  Â  Â  border-top: 5px solid #007bff;Â 
Â  Â  Â  Â  Â  Â  z-index: 1000;
            display: flex; /* Active flexbox pour le conteneur principal */
            flex-direction: column; /* Empile les Ã©lÃ©ments verticalement */
Â  Â  Â  Â  }

        /* Conteneur pour gÃ©rer l'espace vertical */
        #panier-content-wrapper {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            overflow-y: auto; /* Permet le dÃ©filement si le panier est trop haut */
        }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Conteneur pour mettre les champs d'infos cÃ´te Ã  cÃ´te */
Â  Â  Â  Â  .info-membre-container {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 10px;Â 
Â  Â  Â  Â  Â  Â  align-items: flex-end;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .info-membre-item {
Â  Â  Â  Â  Â  Â  flex: 1;Â 
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  }
Â  Â  Â  Â  #panier-fixe h2 {
Â  Â  Â  Â  Â  Â  font-size: 1.1em;Â 
Â  Â  Â  Â  Â  Â  margin: 0 0 5px 0;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Styles de formulaire et boutons compacts */
Â  Â  Â  Â  input[type="text"], select {
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  padding: 4px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  font-size: 0.8em;
Â  Â  Â  Â  }
Â  Â  Â  Â  label {
Â  Â  Â  Â  Â  Â  Â font-size: 0.7em;Â 
Â  Â  Â  Â  }

        /* Conteneur pour mettre les deux boutons (Valider/Annuler) cÃ´te Ã  cÃ´te */
Â  Â  Â  Â  #command-buttons-flex {
Â  Â  Â  Â  Â  Â  display: flex !important;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  }

        /* Style des boutons Annuler et Valider */
Â  Â  Â  Â  .btn-cancel, .btn-send {
            padding: 6px 20px;
            flex-grow: 1; /* Permet aux deux boutons de prendre une part Ã©gale de l'espace */
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .btn-cancel {
            background-color: #dc3545; /* Rouge pour Annuler */
            color: white;
        }

Â  Â  Â  Â  .btn-send {
Â  Â  Â  Â  Â  Â  background-color: #28a745; /* Vert pour Valider */
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-add {
Â  Â  Â  Â  Â  Â  background-color: #007bff;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 5px 10px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-add:disabled {
Â  Â  Â  Â  Â  Â  background-color: #cccccc;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  }

        /* Le dÃ©filement est sur la liste */
        #liste-panier {
            list-style: none;
            padding: 0;
            margin: 5px 0;Â 
            font-size: 0.8em;Â 
            flex-grow: 1; /* Prend l'espace disponible */
            overflow-y: auto; /* Active le dÃ©filement */
        }

Â  Â  Â  Â  #liste-panier li {
Â  Â  Â  Â  Â  Â  padding: 2px 0;
Â  Â  Â  Â  Â  Â  border-bottom: 1px dotted #eee;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* RÃˆGLES SPÃ‰CIALES POUR PC (Limiter la largeur du panier sur grand Ã©cran) */
Â  Â  Â  Â  @media (min-width: 768px) {
Â  Â  Â  Â  Â  Â  #panier-fixe {
Â  Â  Â  Â  Â  Â  Â  Â  width: 400px !important;Â 
Â  Â  Â  Â  Â  Â  Â  Â  left: 50% !important;Â 
                right: auto !important;
Â  Â  Â  Â  Â  Â  Â  Â  transform: translateX(-50%) !important;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

Â  Â  <div id="panier-fixe">
Â  Â  Â  Â  <h2>ðŸ›’ Panier (<span id="total-panier">0.00 â‚¬</span>)</h2>
Â  Â  Â  Â Â 
        <div id="panier-content-wrapper">
            <ul id="liste-panier">
    Â  Â  Â  Â  Â  Â  <li>Le panier est vide.</li>
    Â  Â  Â  Â  </ul>
    Â  Â  Â  Â Â 
    Â  Â  Â  Â  <div class="info-membre-container">
    Â  Â  Â  Â  Â  Â  <div class="info-membre-item">
    Â  Â  Â  Â  Â  Â  Â  Â  <label for="nom-membre">Nom / Pseudo :</label>
    Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="nom-membre" required>
    Â  Â  Â  Â  Â  Â  </div>

    Â  Â  Â  Â  Â  Â  <div class="info-membre-item">
    Â  Â  Â  Â  Â  Â  Â  Â  <label for="mode-paiement">Paiement :</label>
    Â  Â  Â  Â  Â  Â  Â  Â  <select id="mode-paiement" required>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled selected>Choisir mode paiement</option>
                        <option value="EspÃ¨ces">EspÃ¨ces</option>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Ardoise">Ardoise</option>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="PayPal">PayPal</option>
    Â  Â  Â  Â  Â  Â  Â  Â  </select>
    Â  Â  Â  Â  Â  Â  </div>
    Â  Â  Â  Â  </div>

    Â  Â  Â  Â  <div id="command-buttons-flex">
    Â  Â  Â  Â  Â  Â  <button onclick="annulerCommande()" class="btn-cancel">
    Â  Â  Â  Â  Â  Â  Â  Â  Annuler la Commande
    Â  Â  Â  Â  Â  Â  </button>
    Â  Â  Â  Â  Â  Â  <button onclick="envoyerCommande()" class="btn-send">
    Â  Â  Â  Â  Â  Â  Â  Â  Valider la Commande
    Â  Â  Â  Â  Â  Â  </button>
    Â  Â  Â  Â  </div>
        </div>
Â  Â  </div>
Â  Â Â 
    <img id="logo-asso" src="logo_gardiens_du_jeu.png" alt="Logo de l'association Gardiens du Jeu" style="width: 80px; height: 80px; position: absolute; top: 20px; right: 20px; z-index: 50;">

Â  Â  <h1>Bienvenue aux Gardiens du Jeu !</h1>Â 

Â  Â  <p>Retrouvez ici notre catalogue de boissons et de snacks.</p>

Â  Â  <hr>

Â  Â  <h2>Catalogue Boissons & Snacks</h2>
Â  Â Â 
Â  Â  <div id="catalogue-produits">
Â  Â  Â  Â  <p>Chargement des produits...</p>
Â  Â  </div>

Â  Â  <hr>
Â  Â Â 
Â  Â  <p>Bonne partie Ã  tous !</p>

Â  Â  <script>
Â  Â  Â  Â  let panier = [];
        let allProduits = []; 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ******************************************************************
Â  Â  Â  Â  // !!! REMPLACEZ CETTE VALEUR PAR VOTRE URL D'EXECUTION RÃ‰ELLE !!!
Â  Â  Â  Â  const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwlTfMYv9qy8piOYEuv9UA0NuJ2yS9V5PzWTJWJjtGirhyOfJ-dtx5WmWmUmwEiGfSt/exec";
Â  Â  Â  Â  // ******************************************************************

Â  Â  Â  Â  // Fonction pour mettre Ã  jour l'affichage du panier
Â  Â  Â  Â  function mettreAJourAffichagePanier() {
Â  Â  Â  Â  Â  Â  const listePanier = document.getElementById('liste-panier');
Â  Â  Â  Â  Â  Â  const totalPanierElement = document.querySelector('#panier-fixe h2 span');
Â  Â  Â  Â  Â  Â  let total = 0;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  listePanier.innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (panier.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  listePanier.innerHTML = '<li>Le panier est vide.</li>';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  panier.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.textContent = `${item.nom} (x${item.quantite}) - ${(item.prix * item.quantite).toFixed(2)} â‚¬`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listePanier.appendChild(li);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  total += item.prix * item.quantite;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  totalPanierElement.textContent = total.toFixed(2) + ' â‚¬';
Â  Â  Â  Â  }

Â  Â  Â  Â  // Fonction appelÃ©e par les boutons "Ajouter au Panier"
Â  Â  Â  Â  function ajouterAuPanier(nomProduit, prixProduit) {
Â  Â  Â  Â  Â  Â  const itemIndex = panier.findIndex(item => item.nom === nomProduit);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (itemIndex > -1) {
Â  Â  Â  Â  Â  Â  Â  Â  panier[itemIndex].quantite += 1;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  panier.push({ nom: nomProduit, prix: prixProduit, quantite: 1 });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  mettreAJourAffichagePanier();
Â  Â  Â  Â  Â  Â  console.log(`${nomProduit} ajoutÃ© au panier !`);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Fonction pour envoyer la commande Ã  Google Sheets
Â  Â  Â  Â  function envoyerCommande() {
Â  Â  Â  Â  Â  Â  const nomMembreInput = document.getElementById('nom-membre');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (panier.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Votre panier est vide. Ajoutez des articles pour commander.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (!nomMembreInput.value) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Veuillez entrer votre nom/pseudo pour valider la commande.");
Â  Â  Â  Â  Â  Â  Â  Â  nomMembreInput.focus();
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const nomMembre = nomMembreInput.value;
Â  Â  Â  Â  Â  Â  const modePaiement = document.getElementById('mode-paiement').value;
Â  Â  Â  Â  Â  Â  const total = panier.reduce((sum, item) => sum + (item.prix * item.quantite), 0);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let articlesString = panier.map(item => `${item.nom} (x${item.quantite})`).join('; ');

Â  Â  Â  Â  Â  Â  // Construction des donnÃ©es Ã  envoyer
Â  Â  Â  Â  Â  Â  const formData = new FormData();
Â  Â  Â  Â  Â  Â  formData.append('NomMembre', nomMembre);
Â  Â  Â  Â  Â  Â  formData.append('ArticlesCommandes', articlesString);
Â  Â  Â  Â  Â  Â  formData.append('ModeDePaiement', modePaiement);
Â  Â  Â  Â  Â  Â  formData.append('CoutTotal', total.toFixed(2));

Â  Â  Â  Â  Â  Â  // Envoi des donnÃ©es au Google Apps Script via Fetch
Â  Â  Â  Â  Â  Â  fetch(APPS_SCRIPT_URL, {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  body: formData
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  if (data.success) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`Commande de ${total.toFixed(2)} â‚¬ enregistrÃ©e avec succÃ¨s pour ${nomMembre} !\nLe gÃ©rant vous servira sous peu.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // RÃ©initialisation aprÃ¨s succÃ¨s
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  panier = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mettreAJourAffichagePanier();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nomMembreInput.value = '';
                    document.getElementById('mode-paiement').value = ""; // RÃ©initialiser le mode de paiement
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Erreur lors de l'enregistrement de la commande. Veuillez prÃ©venir le gÃ©rant.");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Erreur de connexion ou de script:', error);
Â  Â  Â  Â  Â  Â  Â  Â  alert("Erreur de connexion : impossible d'enregistrer la commande. Le gÃ©rant doit vÃ©rifier la connexion.");
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

        // FONCTION POUR ANNULER LA COMMANDE
        function annulerCommande() {
            const nomMembreInput = document.getElementById('nom-membre');
            
            if (panier.length === 0) {
                alert("Le panier est dÃ©jÃ  vide !");
                return;
            }

            const confirmation = confirm("ÃŠtes-vous sÃ»r de vouloir annuler la commande et vider le panier ?");

            if (confirmation) {
                panier = []; // Vide le tableau du panier
                mettreAJourAffichagePanier(); // Met Ã  jour l'affichage
                
                // RÃ©initialisation des champs de saisie
                nomMembreInput.value = '';
                document.getElementById('mode-paiement').value = "";
                
                alert("Commande annulÃ©e. Le panier a Ã©tÃ© vidÃ©.");
            }
        }

Â  Â  Â  Â  // Fonction asynchrone pour charger les donnÃ©es et les afficher
Â  Â  Â  Â  async function chargerCatalogue() {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('catalogue-produits');
            
            try {
                // Pour cet exemple, on suppose que le catalogue doit Ãªtre rechargÃ©
                const response = await fetch('./produits.json');
                
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
                const produits = await response.json();
                container.innerHTML = '';

                // Regrouper les produits par catÃ©gorie (logique simplifiÃ©e)
                const produitsParCategorie = produits.reduce((acc, produit) => {
                    (acc[produit.categorie] = acc[produit.categorie] || []).push(produit);
                    return acc;
                }, {});
                
                // Afficher chaque catÃ©gorie et ses produits
                for (const categorie in produitsParCategorie) {
                    const categorieSection = document.createElement('div');
                    categorieSection.classList.add('categorie-section');
                    categorieSection.innerHTML = `<h3>${categorie}</h3>`;
                    container.appendChild(categorieSection);

                    produitsParCategorie[categorie].forEach(produit => {
                        const produitDiv = document.createElement('div');
                        produitDiv.classList.add('produit');
                        
                        const estDisponible = produit.stock > 0;
                        
                        let statutStock = `<span class="prix">${produit.prix.toFixed(2)} â‚¬</span>`;
                        let boutonAction = '';
                        
                        if (!estDisponible) {
                            statutStock = `<span class="rupture">RUPTURE DE STOCK</span>`;
                            produitDiv.style.opacity = '0.5';Â 
                            boutonAction = `<button class="btn-add" disabled>Rupture</button>`;
                        } else {
                            // Ajout du bouton d'action
                            boutonAction = `<button class="btn-add" onclick="ajouterAuPanier('${produit.nom}', ${produit.prix})">Ajouter au Panier</button>`;
                        }

                        // CrÃ©er la structure HTML du produit
                        produitDiv.innerHTML = `
                            <h4>${produit.nom}</h4>
                            <p><strong>Prix :</strong> ${statutStock}</p>
                            <p>Stock restant : ${produit.stock}</p>
                            ${boutonAction}
                        `;

                        container.appendChild(produitDiv);
                    });
                }
            } catch (error) {
                container.innerHTML = `<p style="color: red;">DÃ©solÃ©, impossible de charger le catalogue : ${error.message}. VÃ©rifiez que le fichier produits.json est correct.</p>`;
                console.error("Erreur de chargement du catalogue:", error);
            }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Appel des fonctions
Â  Â  Â  Â  chargerCatalogue();
Â  Â  Â  Â  mettreAJourAffichagePanier();
Â  Â  </script>
Â  Â  </body>
</html>
