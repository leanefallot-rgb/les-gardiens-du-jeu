<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Catalogue - Gardiens du Jeu</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 80px 20px 200px;
    background:#f4f4f4;
}

h1,h2,h3 { color:#333; }

.produits-groupe {
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(250px,1fr));
    gap:15px;
}

.produit {
    background:#fff;
    padding:15px;
    border-radius:8px;
    box-shadow:0 2px 4px rgba(0,0,0,.1);
}

.prix { color:green;font-weight:bold; }
.rupture { color:red;font-weight:bold; }

button {
    padding:8px;
    border:none;
    border-radius:4px;
    cursor:pointer;
}

.btn-add { background:#007bff;color:white; width:100%; }
.btn-add:disabled { background:#ccc; }

.btn-add-formule {
    background:#20c997;
    color:white;
    width:100%;
    font-weight:bold;
}
.btn-add-formule:disabled { background:#ccc; }

#panier-fixe {
    position:fixed;
    bottom:0;left:0;right:0;
    background:white;
    border-top:4px solid #007bff;
    padding:10px;
}

#liste-panier { list-style:none;padding:0;margin:5px 0; }
#liste-panier li { border-bottom:1px dotted #ddd;padding:3px 0; }

.form-options select {
    width:100%;
    padding:6px;
    margin-top:4px;
}
</style>
</head>

<body>

<h1>Catalogue Boissons & Repas</h1>

<div id="catalogue-produits"></div>

<div id="panier-fixe">
    <h2>ðŸ›’ Panier (<span id="total-panier">0.00 â‚¬</span>)</h2>
    <ul id="liste-panier"><li>Panier vide</li></ul>
</div>

<script>
/* ========= DONNÃ‰ES ========= */

const choixBoissons = [
    { nom:"Coca-Cola", supplement:0 },
    { nom:"Desperados", supplement:1 },
    { nom:"Perrier", supplement:0 }
];

const choixSnacks = ["Twix","Mars"];
const choixNouilles = ["Nouilles poulet","Nouilles boeuf"];

let allProduits = [
    { nom:"Coca-Cola", prix:1, stock:10 },
    { nom:"Desperados", prix:2, stock:5 },
    { nom:"Perrier", prix:1, stock:5 },
    { nom:"Twix", prix:1, stock:8 },
    { nom:"Mars", prix:1, stock:8 },
    { nom:"Nouilles poulet", prix:2, stock:5 },
    { nom:"Nouilles boeuf", prix:2, stock:5 },

    {
        nom:"Formule Nouilles",
        base_prix:5,
        prix:5,
        stock:20,
        options:[
            { nom:"Nouilles", choix:choixNouilles },
            { nom:"Boisson", choix:choixBoissons },
            { nom:"Snack", choix:choixSnacks }
        ]
    }
];

let panier = [];

/* ========= PANIER ========= */

function updatePanier() {
    const ul = document.getElementById("liste-panier");
    const totalSpan = document.getElementById("total-panier");
    ul.innerHTML="";
    let total=0;

    if(panier.length===0){
        ul.innerHTML="<li>Panier vide</li>";
        totalSpan.textContent="0.00 â‚¬";
        return;
    }

    panier.forEach(item=>{
        total+=item.prix*item.quantite;
        const li=document.createElement("li");
        let txt=`${item.nom}`;
        if(item.details) txt+=` (${item.details.join(", ")})`;
        txt+=` x${item.quantite} - ${(item.prix*item.quantite).toFixed(2)} â‚¬`;
        li.textContent=txt;
        ul.appendChild(li);
    });

    totalSpan.textContent=total.toFixed(2)+" â‚¬";
}

/* ========= FORMULES ========= */

function creerFormule(produit){
    const formId="form-"+produit.nom.replace(/\s/g,"");
    let html=`<form id="${formId}" class="form-options">`;
    html+=`<p><strong>Prix :</strong> <span id="${formId}-prix">${produit.base_prix.toFixed(2)} â‚¬</span></p>`;

    produit.options.forEach((opt,i)=>{
        html+=`
        <label>${opt.nom}</label>
        <select data-index="${i}">
            <option value="">Choisir</option>
        `;
        opt.choix.forEach(c=>{
            const nom=typeof c==="object"?c.nom:c;
            const sup=typeof c==="object"?c.supplement:0;
            html+=`<option value="${nom}" data-supp="${sup}">${nom}${sup?` (+${sup}â‚¬)`:''}</option>`;
        });
        html+="</select>";
    });

    html+=`
    <button type="button"
        class="btn-add-formule"
        data-options="${produit.options.length}"
        disabled
        onclick="ajouterFormule('${produit.nom}','${formId}')">
        Ajouter la formule
    </button>
    </form>`;

    return html;
}

document.addEventListener("change",e=>{
    if(!e.target.closest(".form-options")) return;

    const form=e.target.closest("form");
    const selects=form.querySelectorAll("select");
    let prix=allProduits.find(p=>"form-"+p.nom.replace(/\s/g,"")==form.id).base_prix;
    let complet=true;

    selects.forEach(s=>{
        if(!s.value) complet=false;
        const opt=s.options[s.selectedIndex];
        prix+=parseFloat(opt?.dataset.supp||0);
    });

    form.querySelector("span").textContent=prix.toFixed(2)+" â‚¬";
    const btn=form.querySelector("button");
    btn.disabled=!complet;
});

function ajouterFormule(nomProduit,formId){
    const produit=allProduits.find(p=>p.nom===nomProduit);
    if(produit.stock<=0) return;

    const form=document.getElementById(formId);
    const selects=form.querySelectorAll("select");
    let details=[];
    let prix=produit.base_prix;

    selects.forEach(s=>{
        details.push(s.value);
        prix+=parseFloat(s.options[s.selectedIndex].dataset.supp||0);
    });

    panier.push({
        nom:nomProduit,
        prix,
        base_prix:produit.base_prix,
        quantite:1,
        details
    });

    produit.stock--;
    updatePanier();
    chargerCatalogue();
}

/* ========= CATALOGUE ========= */

function chargerCatalogue(){
    const cont=document.getElementById("catalogue-produits");
    cont.innerHTML="";

    allProduits.forEach(p=>{
        const div=document.createElement("div");
        div.className="produit";
        let action="";

        if(p.options){
            action=creerFormule(p);
        } else {
            action=`<button class="btn-add"
                onclick="ajouterSimple('${p.nom}',${p.prix})"
                ${p.stock<=0?"disabled":""}>
                Ajouter
            </button>`;
        }

        div.innerHTML=`
            <h3>${p.nom}</h3>
            <p>${p.stock>0?`<span class="prix">${p.prix.toFixed(2)} â‚¬</span>`:'<span class="rupture">RUPTURE</span>'}</p>
            ${action}
        `;
        cont.appendChild(div);
    });
}

function ajouterSimple(nom,prix){
    const p=allProduits.find(x=>x.nom===nom);
    if(p.stock<=0) return;
    p.stock--;
    panier.push({nom,prix,quantite:1});
    updatePanier();
    chargerCatalogue();
}

chargerCatalogue();
updatePanier();
</script>

</body>
</html>
