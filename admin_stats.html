<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Remboursements</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body { font-family: 'Inter', sans-serif; margin: 20px; background-color: #f4f4f4; }
    h1 { color: #333; }
    .modal-bg { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; }
    .modal { background:white; padding:20px; border-radius:8px; width:320px; max-width:90%; }
    .modal input, .modal select { width:100%; padding:8px; margin:5px 0 10px 0; border-radius:4px; border:1px solid #ccc; }
    .modal button { padding:8px 12px; border:none; border-radius:4px; cursor:pointer; }
    .btn-close { background:#dc3545; color:white; margin-right:5px; }
    .btn-save { background:#28a745; color:white; }
</style>
</head>
<body>

<div class="max-w-2xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">Remboursements / D√©penses</h1>
    <button id="btn-remboursement" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 mb-6">
        üí∏ Nouveau remboursement
    </button>

    <!-- Modal Remboursement -->
    <div id="modal-remboursement" class="modal-bg flex">
        <div class="modal">
            <h3>Nouvelle d√©pense / remboursement</h3>
            <input type="text" id="remb-nom" placeholder="Nom membre / b√©n√©ficiaire">
            <input type="text" id="remb-description" placeholder="Description">
            <input type="number" step="0.01" id="remb-montant" placeholder="Montant (‚Ç¨)">
            <select id="remb-mode">
                <option value="">Mode de remboursement</option>
                <option value="Esp√®ce">Esp√®ce</option>
                <option value="Virement">Virement</option>
                <option value="Carte">Carte Asso</option>
            </select>
            <div class="flex justify-end">
                <button class="btn-close" onclick="fermerModal()">Annuler</button>
                <button class="btn-save" onclick="enregistrerRemboursement()">Enregistrer</button>
            </div>
        </div>
    </div>
</div>

<script>
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec"; // Remplace par ton URL

// Ouvrir / fermer modal
document.getElementById('btn-remboursement').addEventListener('click', () => {
    document.getElementById('modal-remboursement').style.display = 'flex';
});
function fermerModal() {
    document.getElementById('modal-remboursement').style.display = 'none';
    document.getElementById('remb-nom').value = '';
    document.getElementById('remb-description').value = '';
    document.getElementById('remb-montant').value = '';
    document.getElementById('remb-mode').value = '';
}

// Fonction d'enregistrement
async function enregistrerRemboursement() {
    const nom = document.getElementById('remb-nom').value.trim();
    const desc = document.getElementById('remb-description').value.trim();
    const montant = parseFloat(document.getElementById('remb-montant').value);
    const mode = document.getElementById('remb-mode').value;

    if(!nom || !desc || isNaN(montant) || !mode) {
        alert("Veuillez remplir tous les champs correctement.");
        return;
    }

    const formData = new URLSearchParams();
    formData.append('type', 'remboursement');
    formData.append('NomMembre', nom);
    formData.append('Description', desc);
    formData.append('Montant', montant.toFixed(2));
    formData.append('ModeRemboursement', mode);

    try {
        const res = await fetch(APPS_SCRIPT_URL, { method: 'POST', body: formData });
        const data = await res.json();

        if(data.success) {
            alert("Remboursement enregistr√© !");
            fermerModal();
        } else {
            console.error("Erreur Apps Script:", data.error);
            alert("Erreur: " + (data.error || "Impossible d'enregistrer."));
        }
    } catch(e) {
        console.error("Erreur de connexion:", e);
        alert("Erreur de connexion au serveur.");
    }
}
</script>

</body>
</html>
